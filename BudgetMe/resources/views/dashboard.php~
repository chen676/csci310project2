<?php
require("header.php");
require("navbar.php");
?>

<html>
	<head>
		<link rel="stylesheet" href="./css/styles.css">
    <script>
			function startTime() {
				var today = convertToEasternStandardTimeZone(new Date());
				var date = today.toDateString();
				var hour = (today.getHours()+11)%12 + 1;
				var min = today.getMinutes();
				var sec = today.getSeconds();
				hour = checkTime(hour);
				min = checkTime(min);
				sec = checkTime(sec);
				document.getElementById('clock').innerHTML = date + ",\n" + hour + ":" + min + ":" + sec + " EST";
				var t = setTimeout(startTime, 500);
			}
			function checkTime(i) {
				if (i < 10) {
					i = "0" + i;
				}
				return i;
			}
			function convertToEasternStandardTimeZone(date) {
				//EST
				offset = -5.0;
				clientDate = date;
				utc = clientDate.getTime() + (clientDate.getTimezoneOffset() * 60000);
				ESTDate = new Date(utc + (3600000*offset));
				return ESTDate;
			}
			function onLoad() {
				startTime();
			}
    </script>
	</head>

	<body onload="onLoad()">
	
		<h1>Your Dashboard</h1>

		<div id = "dashboard">

			<div class="widget" id="home">
				<h2>Home</h2>
				<div id="clock"></div>
				<span id="balances"></span>
				<button type="button" id="logoutbutton">Logout</button><br><br>
				<a class="button" href="manual.html">User Manual</a>
			</div>

			<div class="widget" id="budget">
				<h2>Budget</h2>
				<div id="budgetContent">
				</div>
			</div>
			
			<div class="widget" id="graph">
				<h2>Main Line Graph</h2>
				<div id="graph_here">
					<br><br><br><img src="images/ajax-loader.gif" alt="loading...">
				</div>
				<input type="text" id="ticker_text"><button id="graph_stock" onclick="addStock(getElementById('ticker_text').value);">Graph Stock</button>
			</div>

         <div id="accountPanel">
			   <div class="widget" id="transactionHistory">
				   <h2>Transaction History</h2><br>
				   <table>	
					<tr>
						<th>Category</th>
						<th>Amount</th>
						<th>Merchant</th>
						<th>Date</th>
						<th>Account</th>
					</tr>

					<?php
						foreach($transactionSet as $trans)
						{
							echo "<tr>";
							echo "<td>";
							echo $trans['category'];
							echo "</td>";
							echo "<td>";
							echo $trans['amount'];
							echo "</td>";
							echo "<td>";
							echo $trans['merchant'];
							echo "</td>";
							echo "<td>";
							echo $trans['date'];
							echo "</td>";
							echo "<td>";
							echo $trans['account_id'];
							echo "</td>";
							echo "<tr>";
						}
					?>
				   </table>

			   </div>

			   <div class="widget" id="accountList">
				   <h2>Your Accounts</h2>
				<form action="/create_account" method="post">
					<?php echo csrf_field(); ?>
					<div class="form-group">
						<input class="form-control" type="text" id="addAccountField">
					</div>
					<button class="btn btn-success" id="addAccountSubmitButton" type="submit">Add Account</button>
				</form>
				   <?php

					$accounts = $user->accounts;
	
					$accounts = $accounts->toArray();
					usort($accounts, function($lhs, $rhs)
					{
						return strcmp($lhs['name'], $rhs['name']);
					});

					foreach($accounts as $acc)
					{
						echo "<br>";
						echo '<input type="checkbox" id="'. $acc['name'] .'checkbox">';
						var_dump($acc['name']);
					}
				   ?>
			   </div>
         </div>
		</div>

    <script>
			// idle time-out
			$(document).ready(function () {
			    $(document).idleTimeout({
			   		// redirect (logout) on timeout
				    redirectUrl:  "http://localhost/Frontend/logout.php",
				    // idle settings
				    idleTimeLimit: 240,           // 'No activity' time limit in seconds. 240 = 4 Minutes (Total 5 minutes of inactivity for automatic logout)
				    idleCheckHeartbeat: 2,       // Frequency to check for idle timeouts in seconds
				    // warning dialog box configuration
				    enableDialog: true,           // set to false for logout without warning dialog
				    dialogDisplayLimit: 60,       // Time to display the warning dialog before logout (and optional callback) in seconds. 60 = 1 Minute (Total 5 minutes of inactivity for automatic logout)
			    });
			});
		</script>
	</body>
</html>	

</body>
</html>


